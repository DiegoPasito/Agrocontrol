<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro - Agrocontrol</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/CrearCuenta.css">
  
</head>
<body>

  <div class="register-container">
    <div class="row g-0">
      <!-- Secci√≥n del Formulario (Izquierda) -->
      <div class="col-md-6">
        <div class="register-form-section">
          <div class="text-center mb-4">
            <img src="img/Logo Agro sin letras.png" alt="Logo Agrocontrol" class="rounded-circle form-logo" onerror="this.style.display='none'">
            <h3 class="mt-3 mb-1">Agrocontrol</h3>
            <p class="text-muted">Crea tu cuenta</p>
          </div>

          <form id="registerForm">
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre completo</label>
              <input type="text" class="form-control" id="nombre" placeholder="Ej: Juan P√©rez" required>
            </div>

            <div class="mb-3">
              <label for="regEmail" class="form-label">Correo electr√≥nico</label>
              <input type="email" class="form-control" id="regEmail" placeholder="ejemplo@correo.com" required>
            </div>

            <div class="row">
              <div class="col-12 col-md-6 mb-3">
                <label for="regPassword" class="form-label">Contrase√±a</label>
                <input type="password" class="form-control" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
              </div>
              <div class="col-12 col-md-6 mb-3">
                <label for="confirm-password" class="form-label">Confirmar</label>
                <input type="password" class="form-control" id="confirm-password" placeholder="Repite tu contrase√±a" required>
              </div>
            </div>

            <div class="form-check mb-3">
              <input type="checkbox" class="form-check-input" id="terms" required>
              <label class="form-check-label" for="terms">
                Acepto los <a href="#" class="text-decoration-none">t√©rminos y condiciones</a>
              </label>
            </div>

            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-success">Crear Cuenta</button>
            </div>

            <div class="text-center">
              <p class="mb-0">¬øYa tienes cuenta? 
                <a href="index.html" class="text-decoration-none">Inicia sesi√≥n</a>
              </p>
            </div>
          </form>
        </div>
      </div>

      <!-- Secci√≥n Visual (Derecha) -->
      <div class="col-md-6">
        <div class="register-visual-section">
          <div class="visual-content">
            <div class="visual-logo">
              <img src="img/Logo Agro sin letras.png" alt="Logo Agrocontrol" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22%2336ac42%22/%3E%3Cpath d=%22M50 30 L50 70 M30 50 L70 50%22 stroke=%22white%22 stroke-width=%224%22/%3E%3C/svg%3E'">
            </div>
            <h2 class="mb-3">√önete a Agrocontrol</h2>
            <p class="mb-4">Comienza a optimizar la gesti√≥n de tu producci√≥n ganadera hoy mismo</p>
            <div class="mt-4">
              <p class="small mb-1">‚úì Registro r√°pido y sencillo</p>
              <p class="small mb-1">‚úì Acceso completo a todas las funciones</p>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  updateProfile 
} from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { 
  getFirestore, 
  doc, 
  setDoc, 
  serverTimestamp 
} from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAzonIFbhlOnnIs9xG9Lb4uBJHLrhCi3qU",
  authDomain: "web-y-movil-agroncontrol.firebaseapp.com",
  projectId: "web-y-movil-agroncontrol",
  storageBucket: "web-y-movil-agroncontrol.firebasestorage.app",
  messagingSenderId: "180502593551",
  appId: "1:180502593551:web:f4ae5111ac99ec70fa237a",
  measurementId: "G-BJ9G9WSKNY"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// üü¢ Registro
const registerForm = document.querySelector("#registerForm");

if (registerForm) {
  registerForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const nombre = document.getElementById("nombre").value.trim();
    const email = document.getElementById("regEmail").value.trim();
    const password = document.getElementById("regPassword").value;
    const confirmPassword = document.getElementById("confirm-password").value;

    if (password !== confirmPassword) {
      alert("‚ùå Las contrase√±as no coinciden");
      return;
    }

    try {
      // Crear usuario en Authentication
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // Actualizar el perfil de autenticaci√≥n con el nombre
      await updateProfile(user, { displayName: nombre });

      // Guardar informaci√≥n en Firestore
      await setDoc(doc(db, "users", user.uid), {
        nombre: nombre,
        email: email,
        uid: user.uid,
        fechaRegistro: serverTimestamp(),
        ultimoAcceso: serverTimestamp()
      });

      alert("‚úÖ Cuenta creada exitosamente");
      window.location.href = "index.html"; // redirige al login
    } catch (error) {
      console.error("‚ùå Error al registrar usuario:", error);
      alert("‚ùå Error: " + error.message);
    }
  });
}
</script>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
